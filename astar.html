<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>A*</title>
</head>
<body>
    <canvas id="canvas" height="600" width="600" style="border: 1px solid black;"></canvas>
    <p></p>
    <button type="button" onclick="" id="startpoint">Установить точку начала</button>
    <button type="button" onclick="" id="endpoint">Установить точку конца</button>
    <button type="button" onclick="" id="search">Запустить алгоритм</button>
    <button type="button" onclick="" id="modify">Модифицировать лабиринт</button>
    <button type="button" onclick="generate();" id="generate">Сгенерировать новый лабиринт</button>
    <p>Размер лабиринта</p>
    <input type="range" id="size" min="5" max="20" step="1" value="10">
    <script type="module">
        import {generateMaze} from "./mazeGenerator.js";
        import {findPath} from "./aStarAlgo.js";
        const canvas = document.getElementById('canvas');
        const spointbutton = document.getElementById('startpoint');
        const epointbutton = document.getElementById('endpoint');
        const searchbutton = document.getElementById('search');
        const modifybutton = document.getElementById('modify');
        const generatebutton = document.getElementById('generate');
        const sizebutton = document.getElementById('size')
        const ctx = canvas.getContext('2d');
        let maze = [];
        let n = sizebutton.value;
        let s = (600 / (2 * n + 1));
        let spoint = [1, 1];
        let epoint = [2 * n - 1, 2 * n - 1];
        let mapMode = 'none';
        generatebutton.onclick = function(){
            n = sizebutton.value;
            s = (600 / (2 * n + 1));
            generate(n);
        };
        searchbutton.onclick = function(){drawPath()};
        canvas.onclick = function(event){
            let x = event.x - 8;
            let y = event.y - 8;
            if(mapMode === 'none') return;
            let xcell = Math.floor(x / s);
            let ycell = Math.floor(y / s);
            if(mapMode === 'start') spoint = [xcell, ycell];
            else if(mapMode === 'end') epoint = [xcell, ycell];
            else if(mapMode === 'walls') {
                if(maze[xcell][ycell] === 1) maze[xcell][ycell] = 0;
                else maze[xcell][ycell] = 1;
            }
            if(mapMode !== 'walls') mapMode = "none";
            drawMaze()
        };
        spointbutton.onclick = function(){mapMode = 'start'};
        epointbutton.onclick = function(){mapMode = 'end'};
        modifybutton.onclick = function(){
            if(mapMode !== 'walls') mapMode = 'walls';
            else mapMode = 'none';
        }

        function generate(n) {
            maze = generateMaze(n, n)['maze'];
            drawMaze();
        }

        function drawMaze() {
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, 600, 600);
            ctx.fillStyle = 'black';
            for(var i = 0; i < 2 * n + 1; i++) {
                for(var j = 0; j < 2 * n + 1; j++) {
                    if(maze[i][j] === 0) {
                        ctx.fillRect(i * s, j * s, s, s);
                    }
                }
            }
            ctx.fillStyle = "blue";
            ctx.fillRect(spoint[0] * s, spoint[1] * s, s, s);
            ctx.fillStyle = "red";
            ctx.fillRect(epoint[0] * s, epoint[1] * s, s, s);
        }

        function drawPath() {
            const path = findPath(maze, spoint, epoint);
            ctx.fillStyle = 'orange';
            for(var i = 0; i < path['optimal'].length; i++) {
                ctx.fillRect(path['optimal'][i][0] * s, path['optimal'][i][1] * s, s, s);
            }
        }
        generate(n);
    </script>
</body>
</html>